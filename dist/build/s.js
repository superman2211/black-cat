"use strict";(()=>{var H=Math,mt=H.floor,Y=H.ceil,v=H.round,pt=H.min,nt=H.max,bt=H.hypot,Bo=H.abs,Z=H.random,Uo=H.atan2,ye=H.PI,Do=ye*2,dt=(t,e,o)=>pt(e,nt(t,o));function rt(t,e){let o=e.reduce((r,s)=>r+s,0),n=Z()*o,a=0;for(let r=0;r<t.length;r++)if(a+=e[r],n<a)return t[r];return t[0]}var at=document,St="ontouchstart"in window;var be="canvas",y=t=>t.getContext("2d"),G=()=>at.createElement(be),kt=()=>y(G()),st=t=>t.canvas;var vt=(t,e)=>st(t).width=e,Ct=(t,e)=>st(t).height=e;var z=(t,e,o,n)=>t.drawImage(e,v(o),v(n));var tt=()=>performance.now();async function It(t){return new Promise(e=>{setTimeout(e,t)})}var et=tt(),q=0,Mt=()=>{let t=et;et=tt(),q=(et-t)/1e3};var Tt=t=>{let e=0;for(let o of t)e+=o.time;return e},Ht=(t,e)=>{let o=0,n=Tt(t);e%=n;for(let a=0;a<t.length;a++){let r=t[a];if(o+=r.time,e<=o)return r.image}return 0},it=(t,e)=>{let o=Tt(t);return e>=o};var Rt=t=>{let e=t>>24&255,o=t>>16&255,n=t>>8&255,a=t&255;return`rgba(${o}, ${n}, ${a}, ${e/255})`},xt=(t,e,o,n,a,r,s)=>{let c=t.createLinearGradient(e,o,n,a);return c.addColorStop(0,Rt(r)),c.addColorStop(1,Rt(s)),c};var Pt=(t,e,o,n)=>{let a=G(),r=y(a),s=d[o[0]];a.width=t,a.height=e;let c=Y(t/s.width),i=Y(e/s.height);for(let f=0;f<c;f++)for(let m=0;m<i;m++)s=d[rt(o,n)],r.drawImage(s,f*s.width,m*s.height);return a},zt=(t,e,o)=>{let n=G(),a=y(n);n.width=t,n.height=e;let r=d[o],s=Y(t/r.width),c=Y(e/r.height);for(let i=0;i<s;i++)for(let f=0;f<c;f++)a.drawImage(r,i*r.width,f*r.height);return n},At=(t,e)=>{for(let o=0;o<t.length;o+=3){let n=t[o],a=t[o+1],r=t[o+2],s=d[n];z(e,s,a,r)}},N=(t,e,o,n,a,r,s)=>{t.fillStyle=xt(t,e,o,e,o+a,r,s),t.fillRect(e,o,n,a)},ht=(t,e,o,n,a,r,s)=>{t.fillStyle=xt(t,e,o,e+n,o,r,s),t.fillRect(e,o,n,a)},Wt=(t,e)=>{let o=y(t),n=t.width,a=t.height,r=o.getImageData(0,0,n,a),s=r.data,c=0;for(;c<s.length;){let i=s.slice(c,c+4);e(i),s.set(i,c),c+=4}o.putImageData(r,0,0)},Et=t=>{var e=G(),o=y(e);return e.width=t.width,e.height=t.height,o.drawImage(t,0,0),e};var d=[],gt={},ut=t=>{let e=d.length;return d.push(t),e},Ft=(t,e)=>{let o=`${t}_${e}`;if(!gt[o]){let n=e>>16&255,a=e>>8&255,r=e&255,s=Et(d[t]);Wt(s,c=>{c[0]=n,c[1]=a,c[2]=r}),gt[o]=ut(s)}return gt[o]};var Bt,A=()=>Bt,Ut=t=>Bt=t,Dt=()=>{let t=A(),e=d[t.back.image];-t.camera.x>0&&(t.camera.x=0),-t.camera.x+e.width<x&&(t.camera.x=e.width-x),-t.camera.y>0&&(t.camera.y=0),-t.camera.y+e.height<w&&(t.camera.y=e.height-w)};var B=[],Gt=t=>{let e={config:t,state:0,controller:{move:{x:0,y:0},hand:!1,leg:!1},health:0,direction:1,position:{x:0,y:0},animationTime:0,sprite:{image:0}};return B.push(e),e};var qt=()=>{B.splice(0,B.length)},Nt=()=>{let t=A();for(let e of B.values())e.position.x=dt(t.bounds.x,t.bounds.x+t.bounds.w,e.position.x),e.position.y=dt(t.bounds.y,t.bounds.y+t.bounds.h,e.position.y)},Vt=()=>{for(let t of B.values())Se(t)},Se=t=>{let e=null,o=t.config,n=o.animations;switch(t.state){case 0:t.position.x=v(t.position.x),t.position.y=v(t.position.y),e=n.stand,(t.controller.move.x!=0||t.controller.move.y!=0)&&(t.state=1,t.animationTime=0),Ot(t);break;case 1:t.controller.move.x!=0?e=n.walkH:t.controller.move.y!=0?e=n.walkV:(t.state=0,t.animationTime=0);let a=bt(t.controller.move.x,t.controller.move.y);if(a>0){let r=1/a;t.controller.move.x*=r,t.controller.move.y*=r}t.position.x+=t.controller.move.x*o.walkSpeed*q,t.position.y+=t.controller.move.y*o.walkSpeed*q,Ot(t);break;case 2:e=n.jab,it(e,t.animationTime)&&(t.controller.hand?t.state=3:t.state=0,t.animationTime=0);break;case 3:e=n.cross,it(e,t.animationTime)&&(t.controller.hand||(t.state=0,t.animationTime=0));break;case 4:e=n.kick,it(e,t.animationTime)&&(t.state=0,t.animationTime=0);break}t.controller.move.x>0?t.direction=1:t.controller.move.x<0&&(t.direction=-1),e&&(t.animationTime+=q,t.sprite.image=Ht(e,t.animationTime),t.sprite.flipX=t.direction<0)},Lt=()=>{for(let t of B.values())ke(t)},ke=t=>{let e=t.config;t.sprite.x=t.position.x-e.offset.x,t.sprite.y=t.position.y-e.offset.y},Ot=t=>{t.controller.leg&&(t.state=4,t.animationTime=0),t.controller.hand&&(t.state=2,t.animationTime=0)};var co=()=>{let t=[];return t[33]=46,t[35]=0,t[46]=47,t[47]=-1,t.push(10,11,12,13,14,15,16,17,18,19),t[64]=0,t.push(20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45),t},_t=co(),$t=t=>{if(!1)throw`symbol not found ${t} char ${String.fromCharCode(t)}`;return _t[t]};var g=document.getElementById("c");g.style.imageRendering="pixelated";var l=y(g),x=200,w=200,U={x:0,y:0},Kt=()=>{let t=window.innerWidth,e=window.innerHeight,o=pt(t/x,e/w);g.width=nt(x,t/o),g.height=nt(w,e/o),g.style.width=`${t}px`,g.style.height=`${e}px`,U.x=mt((g.width-x)/2),U.y=mt((g.height-w)/2)},jt=()=>{l.clearRect(0,0,g.width,g.height),l.setTransform(1,0,0,1,U.x,U.y);let t=A();l.save(),l.translate(v(-t.camera.x),v(-t.camera.y)),Xt(t.back);for(let o of B.values())Xt(o.sprite);l.restore();let e=10;g.width<g.height?(N(l,0,-e,x,e,4278190080,0),N(l,0,w,x,e,0,4278190080),l.fillStyle="black",l.fillRect(0,-U.y,x,U.y-e),l.fillRect(0,w+e,x,w)):(ht(l,-e,0,e,w,4278190080,0),ht(l,x,0,e,w,0,4278190080),l.fillStyle="black",l.fillRect(-U.x,0,U.x-e,x),l.fillRect(x+e,0,x,w)),fo()},Xt=t=>{l.save();let e=v(t.x||0),o=v(t.y||0),n=d[t.image];t.flipX?l.transform(-1,0,0,1,e+n.width,o):l.transform(1,0,0,1,e,o),z(l,n,0,0),l.restore()},fo=()=>{if(!1){let t=(tt()-et).toFixed(),e=(1/q).toFixed();lo(3,3,`FPS ${e} TIME ${t}`,16777215)}},lo=(t,e,o,n)=>{for(let a=0;a<o.length;a++){let r=o[a].toUpperCase().charCodeAt(0),s=$t(r);if(s!==void 0){let c=Ft(s,n),i=d[c];i!==void 0&&z(l,i,t+a*8,e)}}};var Jt=(...t)=>{let e=D.createBufferSource(),o=D.createBuffer(t.length,t[0].length,b);return t.map((n,a)=>o.getChannelData(a).set(n)),e.buffer=o,e.connect(D.destination),e.start(),e},mo=(t=1,e=.05,o=220,n=0,a=0,r=.1,s=0,c=1,i=0,f=0,m=0,I=0,h=0,M=0,T=0,R=0,u=0,W=1,E=0,X=0)=>{let _=2*Math.PI,K=i*=500*_/b**2,j=(0<T?1:-1)*_/4,L=o*=(1+2*e*Math.random()-e)*_/b,O=[],k=0,J=0,p=0,P=1,lt=0,we=0,F=0,Q,$;for(n=99+b*n,E*=b,a*=b,r*=b,u*=b,f*=500*_/b**3,T*=_/b,m*=_/b,I*=b,h=b*h|0,$=n+E+a+r+u|0;p<$;O[p++]=F)++we%(100*R|0)||(F=s?1<s?2<s?3<s?Math.sin((k%_)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/_%2+2)%2:1-4*Math.abs(Math.round(k/_)-k/_):Math.sin(k),F=(h?1-X+X*Math.sin(2*Math.PI*p/h):1)*(0<F?1:-1)*Math.abs(F)**c*t*po*(p<n?p/n:p<n+E?1-(p-n)/E*(1-W):p<n+E+a?W:p<$-u?($-p-u)/r*W:0),F=u?F/2+(u>p?0:(p<$-u?1:($-p)/u)*O[p-u|0]/2):F),Q=(o+=i+=f)*Math.sin(J*T-j),k+=Q-Q*M*(1-1e9*(Math.sin(p)+1)%2),J+=Q-Q*M*(1-1e9*(Math.sin(p)**2+1)%2),P&&++P>I&&(o+=m,L+=m,P=0),!h||++lt%h||(o=L,i=K,P=P||1);return O},po=.3,b=44100,D=new(window.AudioContext||webkitAudioContext),Qt=(t,e,o,n=125)=>{let a,r,s,c,i,f,m,I,h,M,T,R,u,W,E=0,X,_=[],K=[],j=[],L=0,O=0,k=1,J={},p=44100/n*60>>2;for(;k;L++)_=[k=I=T=u=0],o.map((P,lt)=>{for(m=e[P][L]||[0,0,0],k|=!!e[P][L],X=u+(e[P][0].length-2-!I)*p,W=lt==o.length-1,r=2,c=u;r<m.length+W;I=++r){for(i=m[r],h=r==m.length+W-1&&W||M!=(m[0]||0)|i|0,s=0;s<p&&I;s++>p-99&&h?R+=(R<1)/99:0)f=(1-R)*_[E++]/2||0,K[c]=(K[c]||0)-f*O+f,j[c]=(j[c++]||0)+f*O+f;i&&(R=i%1,O=m[1]||0,(i|=0)&&(_=J[[M=m[E=0]||0,i]]=J[[M,i]]||(a=[...t[M]],a[2]=(a[2]||220)*2**((i-12)/12),i>0?mo(...a):[])))}u=X});return[K,j]};var ct=(t=!1)=>{(t||D.state==="suspended")&&D.resume().catch()},Yt=async t=>{let e=await xo(t),o=Jt(...e);o.loop=!0,D.resume()},xo=async t=>(await It(50),Qt(...t));var wt={},Zt=!1,te=()=>{at.onkeydown=t=>{ct(),Zt=!0,wt[t.keyCode]=!0,t.preventDefault()},at.onkeyup=t=>{Zt=!1,ho(t.keyCode),t.preventDefault()},g.onmousedown=()=>{ct()},g.ontouchstart=()=>{ct()}},C=t=>wt[t],ho=t=>delete wt[t];var ko={walkSpeed:30,offset:{x:16,y:29},animations:{stand:[{image:48,time:.2},{image:49,time:.2},{image:50,time:.2},{image:49,time:.2},{image:48,time:.2},{image:51,time:.2}],walkH:[{image:48,time:.1},{image:52,time:.1},{image:53,time:.1},{image:52,time:.1}],walkV:[{image:59,time:.1},{image:60,time:.1},{image:59,time:.1},{image:61,time:.1}],jab:[{image:48,time:.05},{image:56,time:.1}],cross:[{image:56,time:.1},{image:57,time:.1},{image:58,time:.1},{image:57,time:.1}],kick:[{image:48,time:.05},{image:54,time:.05},{image:55,time:.1},{image:54,time:.1}]}},S,ie=()=>{S=Gt(ko)},ft=()=>S,ce=()=>{S&&(S.controller.move.x=0,S.controller.move.y=0,S.controller.leg=!1,S.controller.hand=!1,(C(37)||C(65))&&(S.controller.move.x=-1),(C(39)||C(68))&&(S.controller.move.x=1),(C(38)||C(87))&&(S.controller.move.y=-1),(C(40)||C(83))&&(S.controller.move.y=1),C(90)&&(S.controller.leg=!0),C(88)&&(S.controller.hand=!0))};var En=1*(Math.exp(.5)-1);var fe,le=[];St||vo();function vo(){fe||(fe=new AudioContext,!1)}async function me(){let e=await(await fetch("r")).arrayBuffer(),o=new Uint8Array(e),n=0,a=o[n++]*4,r=o.slice(n,n+a);n+=a;let s=o[n++];for(;s--;){let i=o[n++],f=o[n++],m=i*f,I=o.slice(n,n+m);n+=m;let h=kt();vt(h,i),Ct(h,f);let M=h.getImageData(0,0,i,f);for(let T=0;T<I.length;T++){let R=I[T]<<2;M.data.set(r.slice(R,R+4),T<<2)}h.putImageData(M,0,0),d.push(st(h))}let c=o[n++];for(;c--;){let i=o[n++];le.push(e.slice(n,n+i)),n+=i}}var pe=[[[.6,0,100,,,.2,1,.5,,-10,,,,3,,,,10],[.7,0,110,,,.2,2,.1,,,,,,,,,,,.1,.4],[1.3,0,300,,,0,4,3,,,300,,,1,,,,.3,.2],[,0,,,.13,.7,2,.2,,,,,.04,.3,,.02,1,,.3,.1],[3,0,60,,,,3,.2,,,,.5,,.6,1,.05],[,0],[,0]],[[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,3,,15,,3,,15,,],[3,.3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,1,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,4,,16,16,4,,16,16,4,,16,,4,,16,16,4,,16,16,4,,16,16,3,,15,15,3,,15,15],[3,.4,,,,,20,,,,,,23,,,,,,25,,,,,,27,,,,,,25,,,,27,,,,,,,,,,,,,,,,28,,27,,,,25,,,,27,,,,25,,]]],[0,0,1,1],,];var xe=()=>{let n=Ao(400,150),a=Wo(400,95),r=G(),s=y(r);r.width=400,r.height=245,z(s,a,0,0),z(s,n,0,95);let c=ut(r),i=10,f=5;return{bounds:{x:i,y:95+f,w:400-i*2,h:150-f*2},back:{image:c},camera:{x:0,y:0}}},Ao=(t,e)=>{let o=Pt(t,e,[0,1,2,3],[3,2,1,1]),n=y(o),a=30;return n.fillStyle="black",n.fillRect(0,0,o.width,1),N(n,0,0,o.width,a,1996488704,0),N(n,0,o.height-a,o.width,a,0,1996488704),he(10,o),o},Wo=(t,e)=>{let o=zt(t,e,4),n=y(o),a=[5,6,7],r=[2,1,1],s=50;for(let i=0;i<t;i+=s)for(let f=0;f<t;f+=16){let m=d[rt(a,r)];z(n,m,i,f)}At([8,s-13,0,8,s*3-13,0,8,s*6-13,0,9,s*2-17,0,9,s*5-30,0],n);let c=40;return N(n,0,o.height-c,o.width,c,0,1996488704),he(10,o),o},he=(t,e)=>{let o=y(e),n=t/2,a=o.getImageData(0,0,e.width,e.height),r=a.data,s=0;for(;s<r.length;){let c=r[s],i=r[s+1],f=r[s+2];r[s]=c-n+t*Z(),r[s+1]=i-n+t*Z(),r[s+2]=f-n+t*Z(),s+=4}o.putImageData(a,0,0)};var ge=()=>{Ut(xe()),qt(),ie();let t=A(),e=ft();e.position.x=t.bounds.x+50,e.position.y=t.bounds.y+t.bounds.h/2};var ue=()=>{let t=A(),e=ft();t.camera.x=e.position.x-x/2,t.camera.y=e.position.y-w/2};!1;var _e=()=>{Mt(),Kt(),ce(),Vt(),Nt(),ue(),Dt(),Lt(),jt(),requestAnimationFrame(_e)};async function Eo(){await me(),Yt(pe),te(),ge(),_e()}Eo();})();
//# sourceMappingURL=s.js.map

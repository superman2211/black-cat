"use strict";(()=>{var z=Math,bt=z.floor,nt=z.ceil,O=z.round,wt=z.min,ct=z.max,_t=z.hypot,kt=z.abs,Y=z.random,Sn=z.atan2,$e=z.PI,vn=$e*2,St=(t,e,o)=>wt(e,ct(t,o)),Le=(t,e,o)=>t+o*(e-t),Bt=(t,e)=>Le(t,e,Y());function mt(t,e){let o=e.reduce((r,i)=>r+i,0),n=Y()*o,a=0;for(let r=0;r<t.length;r++)if(a+=e[r],n<a)return t[r];return t[0]}var ft=document,Wt="ontouchstart"in window;var Ve="canvas",w=t=>t.getContext("2d"),L=()=>ft.createElement(Ve),Et=()=>w(L()),lt=t=>t.canvas;var Ft=(t,e)=>lt(t).width=e,Ot=(t,e)=>lt(t).height=e;var D=(t,e,o,n)=>t.drawImage(e,O(o),O(n));var at=()=>performance.now(),Ut=t=>JSON.parse(JSON.stringify(t));async function Gt(t){return new Promise(e=>{setTimeout(e,t)})}var qt=t=>{let e=t>>24&255,o=t>>16&255,n=t>>8&255,a=t&255;return`rgba(${o}, ${n}, ${a}, ${e/255})`},Nt=(t,e,o,n,a,r,i)=>{let c=t.createLinearGradient(e,o,n,a);return c.addColorStop(0,qt(r)),c.addColorStop(1,qt(i)),c};var Lt=(t,e,o,n)=>{let a=L(),r=w(a),i=f[o[0]];a.width=t,a.height=e;let c=nt(t/i.width),s=nt(e/i.height);for(let m=0;m<c;m++)for(let l=0;l<s;l++)i=f[mt(o,n)],r.drawImage(i,m*i.width,l*i.height);return a},Vt=(t,e,o)=>{let n=L(),a=w(n);n.width=t,n.height=e;let r=f[o],i=nt(t/r.width),c=nt(e/r.height);for(let s=0;s<i;s++)for(let m=0;m<c;m++)a.drawImage(r,s*r.width,m*r.height);return n},jt=(t,e)=>{for(let o=0;o<t.length;o+=3){let n=t[o],a=t[o+1],r=t[o+2],i=f[n];D(e,i,a,r)}},pt=(t,e,o,n,a,r,i)=>{t.fillStyle=Nt(t,e,o,e,o+a,r,i),t.fillRect(e,o,n,a)};var vt=(t,e)=>{let o=w(t),n=t.width,a=t.height,r=o.getImageData(0,0,n,a),i=r.data,c=0;for(;c<i.length;){let s=i.slice(c,c+4);e(s),i.set(s,c),c+=4}o.putImageData(r,0,0)},xt=t=>{var e=L(),o=w(e);return e.width=t.width,e.height=t.height,o.drawImage(t,0,0),e};var Xt=(t,e,o)=>{vt(t,n=>{let a=je(n),r=e.indexOf(a);if(r!=-1){let i=o[r];Xe(i,n)}})},$t=new Uint32Array(1),je=t=>{let e=t[0],o=t[1],n=t[2],a=t[3];return $t[0]=a<<24|e<<16|o<<8|n,$t[0]},Xe=(t,e)=>{let o=t>>24&255,n=t>>16&255,a=t>>8&255,r=t&255;e[0]=n,e[1]=a,e[2]=r,e[3]=o};var f=[],Ct={},rt=t=>{let e=f.length;return f.push(t),e},gt=(t,e)=>{let o=`${t}_${e}`;if(!Ct[o]){let n=e>>24&255,a=e>>16&255,r=e>>8&255,i=e&255,c=xt(f[t]);vt(c,s=>{s[0]=a,s[1]=r,s[2]=i,s[3]&&(s[3]=n)}),Ct[o]=rt(c)}return Ct[o]};var S;(function(t){t.normalize=e=>{let o=t.length(e);o>0&&(e.x/=o,e.y/=o)},t.length=e=>_t(e.x,e.y),t.distance=(e,o)=>_t(e.x-o.x,e.y-o.y),t.add=(e,o)=>({x:e.x+o.x,y:e.y+o.y}),t.subtract=(e,o)=>({x:e.x-o.x,y:e.y-o.y}),t.scale=(e,o)=>({x:e.x*o,y:e.y*o})})(S||(S={}));var it=at(),U=0,Kt=()=>{let t=it;it=at(),U=(it-t)/1e3};var dt=t=>{let e=0;for(let o of t)e+=o.time;return e},Yt=(t,e)=>{let o=0,n=dt(t);e%=n;for(let a=0;a<t.length;a++){let r=t[a];if(o+=r.time,e<=o)return r.image}return 0},st=(t,e)=>{let o=dt(t);return e>=o};var Jt,B=()=>Jt,Qt=t=>Jt=t,Zt=()=>{let t=B(),e=f[t.back.image];-t.camera.x>0&&(t.camera.x=0),-t.camera.x+e.width<_&&(t.camera.x=e.width-_),-t.camera.y>0&&(t.camera.y=0),-t.camera.y+e.height<C&&(t.camera.y=e.height-C)};var x=[],ht=t=>{let e={config:t,state:0,controller:{move:{x:0,y:0},hand:!1,leg:!1},health:t.health,direction:1,position:{x:0,y:0},animationTime:0,sprite:{image:0},shadow:{image:0},damage:0,frame:0};return x.push(e),e},Ke=t=>{let e=x.indexOf(t);e!=-1&&x.splice(e,1)},ee=()=>{x.splice(0,x.length)},oe=()=>{let t=B();for(let e of x.values())e.position.x=St(t.bounds.x,t.bounds.x+t.bounds.w,e.position.x),e.position.y=St(t.bounds.y,t.bounds.y+t.bounds.h,e.position.y)},ne=()=>{for(let t of x.values())Ye(t)},Ye=t=>{let e=null,o=t.config,n=o.animations;switch(t.state){case 0:e=n.stand,(t.controller.move.x!=0||t.controller.move.y!=0)&&(t.state=1,t.animationTime=0),te(t);break;case 1:t.controller.move.x==0&&t.controller.move.y==0?(t.state=0,t.animationTime=0):kt(t.controller.move.x)>kt(t.controller.move.y)?e=n.walkH:e=n.walkV,S.normalize(t.controller.move),t.position.x+=t.controller.move.x*o.walkSpeed*U,t.position.y+=t.controller.move.y*o.walkSpeed*U,te(t);break;case 2:e=n.jab,st(e,t.animationTime)&&(t.controller.hand?t.state=3:t.state=0,t.animationTime=0);break;case 3:e=n.cross,st(e,t.animationTime)&&(t.controller.hand||(t.state=0,t.animationTime=0));break;case 4:e=n.kick,st(e,t.animationTime)&&(t.state=0,t.animationTime=0);break;case 5:e=n.damage,st(e,t.animationTime)&&(t.state=0,t.animationTime=0);break;case 6:e=n.dead,dt(e)<=t.animationTime+U&&(Ke(t),e=null);break}t.controller.move.x>0?t.direction=1:t.controller.move.x<0&&(t.direction=-1),e&&(t.animationTime+=U,t.sprite.image=Yt(e,t.animationTime),t.sprite.flipX=t.direction<0,t.shadow.image=gt(t.sprite.image,1426063360),t.shadow.flipX=t.sprite.flipX),t.damage=0,t.frame!=t.sprite.image&&(t.frame=t.sprite.image,t.damage=o.damages[t.frame]||0)},ae=()=>{for(let t of x){if(t.health<=0||!t.damage)continue;let e=null,o=99999;for(let n of x)if(!(n.health<=0)&&t.config.mob!=n.config.mob&&(n.position.x-t.position.x)*t.direction>0){let r=S.distance(t.position,n.position);r<15&&(!e||o>r)&&(e=n,o=r)}if(e){e.health-=t.damage;let n=e.health>0?5:6;e.state!=n&&(e.state=n,e.animationTime=0),e.position.x+=t.direction*3,console.log("apply damage",t.damage,"health",e.health)}}},re=()=>{for(let t of x.values())Je(t)},Je=t=>{let e=t.config;t.sprite.x=t.position.x-e.offset.x,t.sprite.y=t.position.y-e.offset.y;let o=f[t.shadow.image];t.shadow.scaleY=.4,t.shadow.x=t.position.x-e.offset.x+0,t.shadow.y=t.position.y-e.offset.y*t.shadow.scaleY},te=t=>{t.controller.leg&&(t.state=4,t.animationTime=0),t.controller.hand&&(t.state=2,t.animationTime=0)};var Eo=()=>{let t=[];return t[33]=46,t[35]=0,t[46]=47,t[47]=-1,t.push(10,11,12,13,14,15,16,17,18,19),t[64]=0,t.push(20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45),t},Mt=Eo(),ie=t=>{if(!1)throw`symbol not found ${t} char ${String.fromCharCode(t)}`;return Mt[t]};var h=document.getElementById("c");h.style.imageRendering="pixelated";var d=w(h),_=200,C=200,G={x:0,y:0},se=()=>{let t=window.innerWidth,e=window.innerHeight,o=wt(t/_,e/C);h.width=ct(_,t/o),h.height=ct(C,e/o),h.style.width=`${t}px`,h.style.height=`${e}px`,G.x=bt((h.width-_)/2),G.y=bt((h.height-C)/2)},ce=()=>{d.clearRect(0,0,h.width,h.height),d.setTransform(1,0,0,1,G.x,G.y);let t=B();d.save(),d.translate(O(-t.camera.x),O(-t.camera.y)),It(t.back),x.sort((e,o)=>e.position.y-o.position.y);for(let e of x)It(e.shadow);for(let e of x)It(e.sprite);d.restore(),d.fillStyle="black",h.width<h.height?(d.fillRect(0,-G.y,_,G.y),d.fillRect(0,C,_,C)):(d.fillRect(-G.x,0,G.x,_),d.fillRect(_,0,_,C)),Fo()},It=t=>{d.save();let e=f[t.image],o=1,n=0,a=0,r=t.scaleY||1,i=O(t.x||0),c=O(t.y||0);t.flipX&&(o=-1,i+=e.width),d.transform(o,n,a,r,i,c),D(d,e,0,0),d.restore()},Fo=()=>{if(!1){let t=(at()-it).toFixed(),e=(1/U).toFixed();Oo(3,3,`FPS ${e} TIME ${t}`,2583691263)}},Oo=(t,e,o,n)=>{for(let a=0;a<o.length;a++){let r=o[a].toUpperCase().charCodeAt(0),i=ie(r);if(i!==void 0){let c=gt(i,n),s=f[c];s!==void 0&&D(d,s,t+a*8,e)}}};var me=(...t)=>{let e=q.createBufferSource(),o=q.createBuffer(t.length,t[0].length,k);return t.map((n,a)=>o.getChannelData(a).set(n)),e.buffer=o,e.connect(q.destination),e.start(),e},Uo=(t=1,e=.05,o=220,n=0,a=0,r=.1,i=0,c=1,s=0,m=0,l=0,T=0,g=0,P=0,H=0,R=0,u=0,W=1,E=0,Q=0)=>{let y=2*Math.PI,Z=s*=500*y/k**2,tt=(0<H?1:-1)*y/4,X=o*=(1+2*e*Math.random()-e)*y/k,$=[],v=0,et=0,p=0,A=1,yt=0,Ne=0,F=0,ot,K;for(n=99+k*n,E*=k,a*=k,r*=k,u*=k,m*=500*y/k**3,H*=y/k,l*=y/k,T*=k,g=k*g|0,K=n+E+a+r+u|0;p<K;$[p++]=F)++Ne%(100*R|0)||(F=i?1<i?2<i?3<i?Math.sin((v%y)**3):Math.max(Math.min(Math.tan(v),1),-1):1-(2*v/y%2+2)%2:1-4*Math.abs(Math.round(v/y)-v/y):Math.sin(v),F=(g?1-Q+Q*Math.sin(2*Math.PI*p/g):1)*(0<F?1:-1)*Math.abs(F)**c*t*Go*(p<n?p/n:p<n+E?1-(p-n)/E*(1-W):p<n+E+a?W:p<K-u?(K-p-u)/r*W:0),F=u?F/2+(u>p?0:(p<K-u?1:(K-p)/u)*$[p-u|0]/2):F),ot=(o+=s+=m)*Math.sin(et*H-tt),v+=ot-ot*P*(1-1e9*(Math.sin(p)+1)%2),et+=ot-ot*P*(1-1e9*(Math.sin(p)**2+1)%2),A&&++A>T&&(o+=l,X+=l,A=0),!g||++yt%g||(o=X,s=Z,A=A||1);return $},Go=.3,k=44100,q=new(window.AudioContext||webkitAudioContext),fe=(t,e,o,n=125)=>{let a,r,i,c,s,m,l,T,g,P,H,R,u,W,E=0,Q,y=[],Z=[],tt=[],X=0,$=0,v=1,et={},p=44100/n*60>>2;for(;v;X++)y=[v=T=H=u=0],o.map((A,yt)=>{for(l=e[A][X]||[0,0,0],v|=!!e[A][X],Q=u+(e[A][0].length-2-!T)*p,W=yt==o.length-1,r=2,c=u;r<l.length+W;T=++r){for(s=l[r],g=r==l.length+W-1&&W||P!=(l[0]||0)|s|0,i=0;i<p&&T;i++>p-99&&g?R+=(R<1)/99:0)m=(1-R)*y[E++]/2||0,Z[c]=(Z[c]||0)-m*$+m,tt[c]=(tt[c++]||0)+m*$+m;s&&(R=s%1,$=l[1]||0,(s|=0)&&(y=et[[P=l[E=0]||0,s]]=et[[P,s]]||(a=[...t[P]],a[2]=(a[2]||220)*2**((s-12)/12),s>0?Uo(...a):[])))}u=Q});return[Z,tt]};var ut=(t=!1)=>{(t||q.state==="suspended")&&q.resume().catch()},le=async t=>{let e=await qo(t),o=me(...e);o.loop=!0,q.resume()},qo=async t=>(await Gt(50),fe(...t));var Tt={},pe=!1,xe=()=>{ft.onkeydown=t=>{ut(),pe=!0,Tt[t.keyCode]=!0,t.preventDefault()},ft.onkeyup=t=>{pe=!1,No(t.keyCode),t.preventDefault()},h.onmousedown=()=>{ut()},h.ontouchstart=()=>{ut()}},M=t=>Tt[t],No=t=>delete Tt[t];var Ko={mob:!1,health:1e3,walkSpeed:30,offset:{x:16,y:29},animations:{stand:[{image:48,time:.2},{image:49,time:.2},{image:50,time:.2},{image:49,time:.2},{image:48,time:.2},{image:51,time:.2}],walkH:[{image:48,time:.1},{image:52,time:.1},{image:53,time:.1},{image:52,time:.1}],walkV:[{image:59,time:.1},{image:60,time:.1},{image:59,time:.1},{image:61,time:.1}],jab:[{image:48,time:.05},{image:56,time:.1}],cross:[{image:56,time:.1},{image:57,time:.1},{image:58,time:.1},{image:57,time:.1}],kick:[{image:48,time:.05},{image:54,time:.05},{image:55,time:.1},{image:54,time:.1}],damage:[{image:48,time:1}],dead:[{image:48,time:1}]},damages:{56:20,58:30,55:50}},b,_e=()=>{b=ht(Ko)},J=()=>b,ke=()=>{b&&(b.health<=0||(b.controller.move.x=0,b.controller.move.y=0,b.controller.leg=!1,b.controller.hand=!1,(M(37)||M(65))&&(b.controller.move.x=-1),(M(39)||M(68))&&(b.controller.move.x=1),(M(38)||M(87))&&(b.controller.move.y=-1),(M(40)||M(83))&&(b.controller.move.y=1),M(90)&&(b.controller.leg=!0),M(88)&&(b.controller.hand=!0)))};var ka=1*(Math.exp(.5)-1);var Se,ve=[];Wt||Yo();function Yo(){Se||(Se=new AudioContext,!1)}async function Ce(){let e=await(await fetch("r")).arrayBuffer(),o=new Uint8Array(e),n=0,a=o[n++]*4,r=o.slice(n,n+a);n+=a;let i=o[n++];for(;i--;){let s=o[n++],m=o[n++],l=s*m,T=o.slice(n,n+l);n+=l;let g=Et();Ft(g,s),Ot(g,m);let P=g.getImageData(0,0,s,m);for(let H=0;H<T.length;H++){let R=T[H]<<2;P.data.set(r.slice(R,R+4),H<<2)}g.putImageData(P,0,0),f.push(lt(g))}let c=o[n++];for(;c--;){let s=o[n++];ve.push(e.slice(n,n+s)),n+=s}}var Me=[[[.6,0,100,,,.2,1,.5,,-10,,,,3,,,,10],[.7,0,110,,,.2,2,.1,,,,,,,,,,,.1,.4],[1.3,0,300,,,0,4,3,,,300,,,1,,,,.3,.2],[,0,,,.13,.7,2,.2,,,,,.04,.3,,.02,1,,.3,.1],[3,0,60,,,,3,.2,,,,.5,,.6,1,.05],[,0],[,0]],[[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,3,,15,,3,,15,,],[3,.3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,1,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,4,,16,16,4,,16,16,4,,16,,4,,16,16,4,,16,16,4,,16,16,3,,15,15,3,,15,15],[3,.4,,,,,20,,,,,,23,,,,,,25,,,,,,27,,,,,,25,,,,27,,,,,,,,,,,,,,,,28,,27,,,,25,,,,27,,,,25,,]]],[0,0,1,1],,];var N=[],an=[4278190080,4294939392,4287898002,4289362242,4284354049,4290735454,4278215936,4278217323,4278261885],rn={mob:!0,health:100,walkSpeed:20,offset:{x:16,y:31},animations:{stand:[{image:62,time:.3},{image:63,time:.3},{image:62,time:.3},{image:64,time:.3},{image:65,time:.3},{image:64,time:.3}],walkH:[{image:62,time:.2},{image:66,time:.2},{image:62,time:.2},{image:67,time:.2}],walkV:[{image:62,time:.2},{image:71,time:.2},{image:62,time:.2},{image:72,time:.2}],jab:[{image:62,time:.2},{image:68,time:.2}],cross:[{image:68,time:.2},{image:69,time:.2},{image:70,time:.2},{image:69,time:.2}],kick:[{image:62,time:.2},{image:73,time:.2},{image:74,time:.2},{image:73,time:.2}],damage:[{image:62,time:.1},{image:75,time:.5},{image:62,time:.1}],dead:[{image:62,time:.1},{image:75,time:.5},{image:76,time:5}]},damages:{68:10,70:20,74:30}},Rt=[],De=()=>{Rt.push(Ae([4278190080,4294939392,4281545523,4281545523,4288256409,4294939392,4278190131,4278190131,4278190080],"bob")),Rt.push(Ae([4278190080,4294939392,4285642965,4294939392,4294939392,4278190080,4286151563,4286151563,4278190080],"jack"))},Ae=(t,e)=>{let o=Ut(rn);o.walkSpeed=Bt(10,20);let n=o.animations;for(let a in n){let r=n[a];sn(r,an,t,e)}return o},sn=(t,e,o,n)=>{for(let a of t)a.image=cn(a.image,e,o,n)},zt={},cn=(t,e,o,n)=>{let a=`${t}_${n}`;if(!zt[a]){let r=xt(f[t]);Xt(r,e,o),zt[a]=rt(r)}return zt[a]},At=t=>{let e=ht(Rt[t]);return N.push(e),e};var mn=t=>{let e=N.indexOf(t);e!=-1&&N.splice(e,1)},Be=()=>{let t=J();for(let e of N)fn(e,t)},fn=(t,e)=>{if(t.health<=0)return;x.indexOf(t)==-1&&mn(t),t.controller.move.x=0,t.controller.move.y=0,t.controller.leg=!1,t.controller.hand=!1;let o=S.subtract(e.position,t.position);S.length(o)>15?(S.normalize(o),t.controller.move.x=o.x,t.controller.move.y=o.y):(t.controller.move.x=0,t.controller.move.y=0)},We=()=>{for(let e=0;e<N.length;e++){let o=N[e];if(!(o.health<=0))for(let n=e+1;n<N.length;n++){let a=N[n];if(a.health<=0)continue;let r=S.subtract(o.position,a.position);r.x==0&&r.y==0&&(r.x=1);let i=S.length(r);if(i<10){let c=(10-i)/i,s=S.scale(r,c);o.position.x+=s.x,o.position.y+=s.y,a.position.x-=s.x,a.position.y-=s.y}}}};var Fe=()=>{let n=bn(400,150),a=wn(400,95),r=L(),i=w(r);r.width=400,r.height=245,D(i,a,0,0),D(i,n,0,95);let c=rt(r),s=10,m=5;return{bounds:{x:s,y:95+m,w:400-s*2,h:150-m*2},back:{image:c},camera:{x:0,y:0}}},bn=(t,e)=>{let o=Lt(t,e,[0,1,2,3],[3,2,1,1]),n=w(o),a=30;return n.fillStyle="black",n.fillRect(0,0,o.width,1),pt(n,0,0,o.width,a,1996488704,0),pt(n,0,o.height-a,o.width,a,0,1996488704),Oe(10,o),o},wn=(t,e)=>{let o=Vt(t,e,4),n=w(o),a=[5,6,7],r=[2,1,1],i=50;for(let s=0;s<t;s+=i)for(let m=0;m<t;m+=16){let l=f[mt(a,r)];D(n,l,s,m)}jt([8,i-13,0,8,i*3-13,0,8,i*6-13,0,9,i*2-17,0,9,i*5-30,0],n);let c=40;return pt(n,0,o.height-c,o.width,c,0,1996488704),Oe(10,o),o},Oe=(t,e)=>{let o=w(e),n=t/2,a=o.getImageData(0,0,e.width,e.height),r=a.data,i=0;for(;i<r.length;){let c=r[i],s=r[i+1],m=r[i+2];r[i]=c-n+t*Y(),r[i+1]=s-n+t*Y(),r[i+2]=m-n+t*Y(),i+=4}o.putImageData(a,0,0)};var Ue=()=>{Qt(Fe()),ee(),_e();let t=B(),e=At(0);e.position.x=t.bounds.x+100,e.position.y=t.bounds.y+t.bounds.h/2;let o=At(1);o.position.x=t.bounds.x+120,o.position.y=t.bounds.y+t.bounds.h/2+20;let n=J();n.position.x=t.bounds.x+50,n.position.y=t.bounds.y+t.bounds.h/2};var Ge=()=>{let t=B(),e=J();t.camera.x=e.position.x-_/2,t.camera.y=e.position.y-C/2};!1;var qe=()=>{Kt(),se(),ke(),Be(),We(),ne(),ae(),oe(),Ge(),Zt(),re(),ce(),requestAnimationFrame(qe)};async function _n(){await Ce(),le(Me),xe(),De(),Ue(),qe()}_n();})();
//# sourceMappingURL=s.js.map

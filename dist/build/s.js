"use strict";(()=>{var T=Math,ht=T.floor,Q=T.ceil,S=T.round,ut=T.min,rt=T.max,Pt=T.hypot,pn=T.abs,Z=T.random,xn=T.atan2,ze=T.PI,gn=ze*2,bt=(t,e,o)=>ut(e,rt(t,o));function at(t,e){let o=e.reduce((a,s)=>a+s,0),n=Z()*o,r=0;for(let a=0;a<t.length;a++)if(r+=e[a],n<r)return t[a];return t[0]}var st=document,Tt="ontouchstart"in window;var Be="canvas",b=t=>t.getContext("2d"),q=()=>st.createElement(Be),Ht=()=>b(q()),it=t=>t.canvas;var Rt=(t,e)=>it(t).width=e,At=(t,e)=>it(t).height=e;var z=(t,e,o,n)=>t.drawImage(e,S(o),S(n));var tt=()=>performance.now(),zt=t=>JSON.parse(JSON.stringify(t));async function Bt(t){return new Promise(e=>{setTimeout(e,t)})}var Wt=t=>{let e=t>>24&255,o=t>>16&255,n=t>>8&255,r=t&255;return`rgba(${o}, ${n}, ${r}, ${e/255})`},Et=(t,e,o,n,r,a,s)=>{let c=t.createLinearGradient(e,o,n,r);return c.addColorStop(0,Wt(a)),c.addColorStop(1,Wt(s)),c};var Ot=(t,e,o,n)=>{let r=q(),a=b(r),s=m[o[0]];r.width=t,r.height=e;let c=Q(t/s.width),i=Q(e/s.height);for(let f=0;f<c;f++)for(let l=0;l<i;l++)s=m[at(o,n)],a.drawImage(s,f*s.width,l*s.height);return r},Ut=(t,e,o)=>{let n=q(),r=b(n);n.width=t,n.height=e;let a=m[o],s=Q(t/a.width),c=Q(e/a.height);for(let i=0;i<s;i++)for(let f=0;f<c;f++)r.drawImage(a,i*a.width,f*a.height);return n},Dt=(t,e)=>{for(let o=0;o<t.length;o+=3){let n=t[o],r=t[o+1],a=t[o+2],s=m[n];z(e,s,r,a)}},ct=(t,e,o,n,r,a,s)=>{t.fillStyle=Et(t,e,o,e,o+r,a,s),t.fillRect(e,o,n,r)};var wt=(t,e)=>{let o=b(t),n=t.width,r=t.height,a=o.getImageData(0,0,n,r),s=a.data,c=0;for(;c<s.length;){let i=s.slice(c,c+4);e(i),s.set(i,c),c+=4}o.putImageData(a,0,0)},ft=t=>{var e=q(),o=b(e);return e.width=t.width,e.height=t.height,o.drawImage(t,0,0),e};var Gt=(t,e,o)=>{wt(t,n=>{let r=We(n),a=e.indexOf(r);if(a!=-1){let s=o[a];Ee(s,n)}})},Ft=new Uint32Array(1),We=t=>{let e=t[0],o=t[1],n=t[2],r=t[3];return Ft[0]=r<<24|e<<16|o<<8|n,Ft[0]},Ee=(t,e)=>{let o=t>>24&255,n=t>>16&255,r=t>>8&255,a=t&255;e[0]=n,e[1]=r,e[2]=a,e[3]=o};var m=[],yt={},et=t=>{let e=m.length;return m.push(t),e},mt=(t,e)=>{let o=`${t}_${e}`;if(!yt[o]){let n=e>>24&255,r=e>>16&255,a=e>>8&255,s=e&255,c=ft(m[t]);wt(c,i=>{i[0]=r,i[1]=a,i[2]=s,i[3]&&(i[3]=n)}),yt[o]=et(c)}return yt[o]};var ot=tt(),N=0,qt=()=>{let t=ot;ot=tt(),N=(ot-t)/1e3};var Nt=t=>{let e=0;for(let o of t)e+=o.time;return e},Vt=(t,e)=>{let o=0,n=Nt(t);e%=n;for(let r=0;r<t.length;r++){let a=t[r];if(o+=a.time,e<=o)return a.image}return 0},lt=(t,e)=>{let o=Nt(t);return e>=o};var $t,B=()=>$t,Lt=t=>$t=t,jt=()=>{let t=B(),e=m[t.back.image];-t.camera.x>0&&(t.camera.x=0),-t.camera.x+e.width<w&&(t.camera.x=e.width-w),-t.camera.y>0&&(t.camera.y=0),-t.camera.y+e.height<v&&(t.camera.y=e.height-v)};var H=[],pt=t=>{let e={config:t,state:0,controller:{move:{x:0,y:0},hand:!1,leg:!1},health:0,direction:1,position:{x:0,y:0},animationTime:0,sprite:{image:0},shadow:{image:0}};return H.push(e),e};var Kt=()=>{H.splice(0,H.length)},Yt=()=>{let t=B();for(let e of H.values())e.position.x=bt(t.bounds.x,t.bounds.x+t.bounds.w,e.position.x),e.position.y=bt(t.bounds.y,t.bounds.y+t.bounds.h,e.position.y)},Jt=()=>{for(let t of H.values())Fe(t)},Fe=t=>{let e=null,o=t.config,n=o.animations;switch(t.state){case 0:t.position.x=S(t.position.x),t.position.y=S(t.position.y),e=n.stand,(t.controller.move.x!=0||t.controller.move.y!=0)&&(t.state=1,t.animationTime=0),Xt(t);break;case 1:t.controller.move.x!=0?e=n.walkH:t.controller.move.y!=0?e=n.walkV:(t.state=0,t.animationTime=0);let r=Pt(t.controller.move.x,t.controller.move.y);if(r>0){let a=1/r;t.controller.move.x*=a,t.controller.move.y*=a}t.position.x+=t.controller.move.x*o.walkSpeed*N,t.position.y+=t.controller.move.y*o.walkSpeed*N,Xt(t);break;case 2:e=n.jab,lt(e,t.animationTime)&&(t.controller.hand?t.state=3:t.state=0,t.animationTime=0);break;case 3:e=n.cross,lt(e,t.animationTime)&&(t.controller.hand||(t.state=0,t.animationTime=0));break;case 4:e=n.kick,lt(e,t.animationTime)&&(t.state=0,t.animationTime=0);break}t.controller.move.x>0?t.direction=1:t.controller.move.x<0&&(t.direction=-1),e&&(t.animationTime+=N,t.sprite.image=Vt(e,t.animationTime),t.sprite.flipX=t.direction<0,t.shadow.image=mt(t.sprite.image,1426063360),t.shadow.flipX=t.sprite.flipX)},Qt=()=>{for(let t of H.values())Oe(t)},Oe=t=>{let e=t.config;t.sprite.x=t.position.x-e.offset.x,t.sprite.y=t.position.y-e.offset.y;let o=m[t.shadow.image];t.shadow.scaleY=.4,t.shadow.x=t.position.x-e.offset.x+0,t.shadow.y=t.position.y-e.offset.y*t.shadow.scaleY},Xt=t=>{t.controller.leg&&(t.state=4,t.animationTime=0),t.controller.hand&&(t.state=2,t.animationTime=0)};var vo=()=>{let t=[];return t[33]=46,t[35]=0,t[46]=47,t[47]=-1,t.push(10,11,12,13,14,15,16,17,18,19),t[64]=0,t.push(20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45),t},_t=vo(),Zt=t=>{if(!1)throw`symbol not found ${t} char ${String.fromCharCode(t)}`;return _t[t]};var d=document.getElementById("c");d.style.imageRendering="pixelated";var g=b(d),w=200,v=200,O={x:0,y:0},te=()=>{let t=window.innerWidth,e=window.innerHeight,o=ut(t/w,e/v);d.width=rt(w,t/o),d.height=rt(v,e/o),d.style.width=`${t}px`,d.style.height=`${e}px`,O.x=ht((d.width-w)/2),O.y=ht((d.height-v)/2)},ee=()=>{g.clearRect(0,0,d.width,d.height),g.setTransform(1,0,0,1,O.x,O.y);let t=B();g.save(),g.translate(S(-t.camera.x),S(-t.camera.y)),kt(t.back),H.sort((e,o)=>e.position.y-o.position.y);for(let e of H)kt(e.shadow);for(let e of H)kt(e.sprite);g.restore(),g.fillStyle="black",d.width<d.height?(g.fillRect(0,-O.y,w,O.y),g.fillRect(0,v,w,v)):(g.fillRect(-O.x,0,O.x,w),g.fillRect(w,0,w,v)),Co()},kt=t=>{g.save();let e=m[t.image],o=1,n=0,r=0,a=t.scaleY||1,s=S(t.x||0),c=S(t.y||0);t.flipX&&(o=-1,s+=e.width),g.transform(o,n,r,a,s,c),z(g,e,0,0),g.restore()},Co=()=>{if(!1){let t=(tt()-ot).toFixed(),e=(1/N).toFixed();Io(3,3,`FPS ${e} TIME ${t}`,2583691263)}},Io=(t,e,o,n)=>{for(let r=0;r<o.length;r++){let a=o[r].toUpperCase().charCodeAt(0),s=Zt(a);if(s!==void 0){let c=mt(s,n),i=m[c];i!==void 0&&z(g,i,t+r*8,e)}}};var oe=(...t)=>{let e=U.createBufferSource(),o=U.createBuffer(t.length,t[0].length,y);return t.map((n,r)=>o.getChannelData(r).set(n)),e.buffer=o,e.connect(U.destination),e.start(),e},Mo=(t=1,e=.05,o=220,n=0,r=0,a=.1,s=0,c=1,i=0,f=0,l=0,I=0,x=0,M=0,P=0,R=0,h=0,W=1,E=0,j=0)=>{let u=2*Math.PI,X=i*=500*u/y**2,K=(0<P?1:-1)*u/4,$=o*=(1+2*e*Math.random()-e)*u/y,G=[],k=0,Y=0,p=0,A=1,dt=0,Ae=0,F=0,J,L;for(n=99+y*n,E*=y,r*=y,a*=y,h*=y,f*=500*u/y**3,P*=u/y,l*=u/y,I*=y,x=y*x|0,L=n+E+r+a+h|0;p<L;G[p++]=F)++Ae%(100*R|0)||(F=s?1<s?2<s?3<s?Math.sin((k%u)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/u%2+2)%2:1-4*Math.abs(Math.round(k/u)-k/u):Math.sin(k),F=(x?1-j+j*Math.sin(2*Math.PI*p/x):1)*(0<F?1:-1)*Math.abs(F)**c*t*Po*(p<n?p/n:p<n+E?1-(p-n)/E*(1-W):p<n+E+r?W:p<L-h?(L-p-h)/a*W:0),F=h?F/2+(h>p?0:(p<L-h?1:(L-p)/h)*G[p-h|0]/2):F),J=(o+=i+=f)*Math.sin(Y*P-K),k+=J-J*M*(1-1e9*(Math.sin(p)+1)%2),Y+=J-J*M*(1-1e9*(Math.sin(p)**2+1)%2),A&&++A>I&&(o+=l,$+=l,A=0),!x||++dt%x||(o=$,i=X,A=A||1);return G},Po=.3,y=44100,U=new(window.AudioContext||webkitAudioContext),ne=(t,e,o,n=125)=>{let r,a,s,c,i,f,l,I,x,M,P,R,h,W,E=0,j,u=[],X=[],K=[],$=0,G=0,k=1,Y={},p=44100/n*60>>2;for(;k;$++)u=[k=I=P=h=0],o.map((A,dt)=>{for(l=e[A][$]||[0,0,0],k|=!!e[A][$],j=h+(e[A][0].length-2-!I)*p,W=dt==o.length-1,a=2,c=h;a<l.length+W;I=++a){for(i=l[a],x=a==l.length+W-1&&W||M!=(l[0]||0)|i|0,s=0;s<p&&I;s++>p-99&&x?R+=(R<1)/99:0)f=(1-R)*u[E++]/2||0,X[c]=(X[c]||0)-f*G+f,K[c]=(K[c++]||0)+f*G+f;i&&(R=i%1,G=l[1]||0,(i|=0)&&(u=Y[[M=l[E=0]||0,i]]=Y[[M,i]]||(r=[...t[M]],r[2]=(r[2]||220)*2**((i-12)/12),i>0?Mo(...r):[])))}h=j});return[X,K]};var xt=(t=!1)=>{(t||U.state==="suspended")&&U.resume().catch()},re=async t=>{let e=await To(t),o=oe(...e);o.loop=!0,U.resume()},To=async t=>(await Bt(50),ne(...t));var St={},ae=!1,se=()=>{st.onkeydown=t=>{xt(),ae=!0,St[t.keyCode]=!0,t.preventDefault()},st.onkeyup=t=>{ae=!1,Ho(t.keyCode),t.preventDefault()},d.onmousedown=()=>{xt()},d.ontouchstart=()=>{xt()}},C=t=>St[t],Ho=t=>delete St[t];var Oo={walkSpeed:30,offset:{x:16,y:29},animations:{stand:[{image:48,time:.2},{image:49,time:.2},{image:50,time:.2},{image:49,time:.2},{image:48,time:.2},{image:51,time:.2}],walkH:[{image:48,time:.1},{image:52,time:.1},{image:53,time:.1},{image:52,time:.1}],walkV:[{image:59,time:.1},{image:60,time:.1},{image:59,time:.1},{image:61,time:.1}],jab:[{image:48,time:.05},{image:56,time:.1}],cross:[{image:56,time:.1},{image:57,time:.1},{image:58,time:.1},{image:57,time:.1}],kick:[{image:48,time:.05},{image:54,time:.05},{image:55,time:.1},{image:54,time:.1}]}},_,xe=()=>{_=pt(Oo)},gt=()=>_,ge=()=>{_&&(_.controller.move.x=0,_.controller.move.y=0,_.controller.leg=!1,_.controller.hand=!1,(C(37)||C(65))&&(_.controller.move.x=-1),(C(39)||C(68))&&(_.controller.move.x=1),(C(38)||C(87))&&(_.controller.move.y=-1),(C(40)||C(83))&&(_.controller.move.y=1),C(90)&&(_.controller.leg=!0),C(88)&&(_.controller.hand=!0))};var fr=1*(Math.exp(.5)-1);var de,he=[];Tt||Uo();function Uo(){de||(de=new AudioContext,!1)}async function ue(){let e=await(await fetch("r")).arrayBuffer(),o=new Uint8Array(e),n=0,r=o[n++]*4,a=o.slice(n,n+r);n+=r;let s=o[n++];for(;s--;){let i=o[n++],f=o[n++],l=i*f,I=o.slice(n,n+l);n+=l;let x=Ht();Rt(x,i),At(x,f);let M=x.getImageData(0,0,i,f);for(let P=0;P<I.length;P++){let R=I[P]<<2;M.data.set(a.slice(R,R+4),P<<2)}x.putImageData(M,0,0),m.push(it(x))}let c=o[n++];for(;c--;){let i=o[n++];he.push(e.slice(n,n+i)),n+=i}}var be=[[[.6,0,100,,,.2,1,.5,,-10,,,,3,,,,10],[.7,0,110,,,.2,2,.1,,,,,,,,,,,.1,.4],[1.3,0,300,,,0,4,3,,,300,,,1,,,,.3,.2],[,0,,,.13,.7,2,.2,,,,,.04,.3,,.02,1,,.3,.1],[3,0,60,,,,3,.2,,,,.5,,.6,1,.05],[,0],[,0]],[[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,3,,15,,3,,15,,],[3,.3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,1,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,4,,16,16,4,,16,16,4,,16,,4,,16,16,4,,16,16,4,,16,16,3,,15,15,3,,15,15],[3,.4,,,,,20,,,,,,23,,,,,,25,,,,,,27,,,,,,25,,,,27,,,,,,,,,,,,,,,,28,,27,,,,25,,,,27,,,,25,,]]],[0,0,1,1],,];var Se=[],Ko=[4278190080,4294939392,4287898002,4289362242,4284354049,4290735454,4278215936,4278217323,4278261885],Yo={walkSpeed:30,offset:{x:16,y:31},animations:{stand:[{image:62,time:.3},{image:63,time:.3},{image:62,time:.3},{image:64,time:.3},{image:65,time:.3},{image:64,time:.3}],walkH:[{image:62,time:.2},{image:66,time:.2},{image:62,time:.2},{image:67,time:.2}],walkV:[{image:62,time:.2},{image:71,time:.2},{image:62,time:.2},{image:72,time:.2}],jab:[{image:62,time:.2},{image:68,time:.2}],cross:[{image:68,time:.2},{image:69,time:.2},{image:70,time:.2},{image:69,time:.2}],kick:[{image:62,time:.2},{image:73,time:.2},{image:74,time:.2}]}},Ct=[],ve=()=>{Ct.push(ke([4278190080,4294939392,4281545523,4281545523,4288256409,4294939392,4278190131,4278190131,4278190080],"bob")),Ct.push(ke([4278190080,4294939392,4285642965,4294939392,4294939392,4278190080,4286151563,4286151563,4278190080],"jack"))},ke=(t,e)=>{let o=zt(Yo),n=o.animations;for(let r in n){let a=n[r];Jo(a,Ko,t,e)}return o},Jo=(t,e,o,n)=>{for(let r of t)r.image=Qo(r.image,e,o,n)},vt={},Qo=(t,e,o,n)=>{let r=`${t}_${n}`;if(!vt[r]){let a=ft(m[t]);Gt(a,e,o),vt[r]=et(a)}return vt[r]},It=t=>{let e=pt(Ct[t]);return Se.push(e),e};var Ce=()=>{for(let t of Se)t.controller.move.x=0,t.controller.move.y=0,t.controller.leg=!1,t.controller.hand=!1};var Me=()=>{let n=cn(400,150),r=fn(400,95),a=q(),s=b(a);a.width=400,a.height=245,z(s,r,0,0),z(s,n,0,95);let c=et(a),i=10,f=5;return{bounds:{x:i,y:95+f,w:400-i*2,h:150-f*2},back:{image:c},camera:{x:0,y:0}}},cn=(t,e)=>{let o=Ot(t,e,[0,1,2,3],[3,2,1,1]),n=b(o),r=30;return n.fillStyle="black",n.fillRect(0,0,o.width,1),ct(n,0,0,o.width,r,1996488704,0),ct(n,0,o.height-r,o.width,r,0,1996488704),Pe(10,o),o},fn=(t,e)=>{let o=Ut(t,e,4),n=b(o),r=[5,6,7],a=[2,1,1],s=50;for(let i=0;i<t;i+=s)for(let f=0;f<t;f+=16){let l=m[at(r,a)];z(n,l,i,f)}Dt([8,s-13,0,8,s*3-13,0,8,s*6-13,0,9,s*2-17,0,9,s*5-30,0],n);let c=40;return ct(n,0,o.height-c,o.width,c,0,1996488704),Pe(10,o),o},Pe=(t,e)=>{let o=b(e),n=t/2,r=o.getImageData(0,0,e.width,e.height),a=r.data,s=0;for(;s<a.length;){let c=a[s],i=a[s+1],f=a[s+2];a[s]=c-n+t*Z(),a[s+1]=i-n+t*Z(),a[s+2]=f-n+t*Z(),s+=4}o.putImageData(r,0,0)};var Te=()=>{Lt(Me()),Kt(),xe();let t=B(),e=It(0);e.position.x=t.bounds.x+100,e.position.y=t.bounds.y+t.bounds.h/2;let o=It(1);o.position.x=t.bounds.x+120,o.position.y=t.bounds.y+t.bounds.h/2+20;let n=gt();n.position.x=t.bounds.x+50,n.position.y=t.bounds.y+t.bounds.h/2};var He=()=>{let t=B(),e=gt();t.camera.x=e.position.x-w/2,t.camera.y=e.position.y-v/2};!1;var Re=()=>{qt(),te(),ge(),Ce(),Jt(),Yt(),He(),jt(),Qt(),ee(),requestAnimationFrame(Re)};async function mn(){await ue(),re(be),se(),ve(),Te(),Re()}mn();})();
//# sourceMappingURL=s.js.map

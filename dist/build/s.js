"use strict";(()=>{var T=Math,ut=T.floor,Q=T.ceil,S=T.round,bt=T.min,rt=T.max,Pt=T.hypot,tn=T.abs,Z=T.random,en=T.atan2,Ae=T.PI,on=Ae*2,wt=(t,e,o)=>bt(e,rt(t,o));function at(t,e){let o=e.reduce((a,s)=>a+s,0),n=Z()*o,r=0;for(let a=0;a<t.length;a++)if(r+=e[a],n<r)return t[a];return t[0]}var st=document,Tt="ontouchstart"in window;var ze="canvas",b=t=>t.getContext("2d"),q=()=>st.createElement(ze),Ht=()=>b(q()),it=t=>t.canvas;var Rt=(t,e)=>it(t).width=e,At=(t,e)=>it(t).height=e;var z=(t,e,o,n)=>t.drawImage(e,S(o),S(n));var tt=()=>performance.now(),zt=t=>JSON.parse(JSON.stringify(t));async function Bt(t){return new Promise(e=>{setTimeout(e,t)})}var Wt=t=>{let e=t>>24&255,o=t>>16&255,n=t>>8&255,r=t&255;return`rgba(${o}, ${n}, ${r}, ${e/255})`},Et=(t,e,o,n,r,a,s)=>{let c=t.createLinearGradient(e,o,n,r);return c.addColorStop(0,Wt(a)),c.addColorStop(1,Wt(s)),c};var Ot=(t,e,o,n)=>{let r=q(),a=b(r),s=l[o[0]];r.width=t,r.height=e;let c=Q(t/s.width),i=Q(e/s.height);for(let f=0;f<c;f++)for(let m=0;m<i;m++)s=l[at(o,n)],a.drawImage(s,f*s.width,m*s.height);return r},Ut=(t,e,o)=>{let n=q(),r=b(n);n.width=t,n.height=e;let a=l[o],s=Q(t/a.width),c=Q(e/a.height);for(let i=0;i<s;i++)for(let f=0;f<c;f++)r.drawImage(a,i*a.width,f*a.height);return n},Dt=(t,e)=>{for(let o=0;o<t.length;o+=3){let n=t[o],r=t[o+1],a=t[o+2],s=l[n];z(e,s,r,a)}},ct=(t,e,o,n,r,a,s)=>{t.fillStyle=Et(t,e,o,e,o+r,a,s),t.fillRect(e,o,n,r)};var ft=(t,e)=>{let o=b(t),n=t.width,r=t.height,a=o.getImageData(0,0,n,r),s=a.data,c=0;for(;c<s.length;){let i=s.slice(c,c+4);e(i),s.set(i,c),c+=4}o.putImageData(a,0,0)},lt=t=>{var e=q(),o=b(e);return e.width=t.width,e.height=t.height,o.drawImage(t,0,0),e},Gt=t=>{let e=[];return ft(t,o=>{let n=$t(o);e.indexOf(n)==-1&&e.push(n)}),e},qt=(t,e,o)=>{ft(t,n=>{let r=$t(n),a=e.indexOf(r);if(a!=-1){let s=o[a];Be(s,n)}})},Ft=new Uint32Array(1),$t=t=>{let e=t[0],o=t[1],n=t[2],r=t[3];return Ft[0]=r<<24|e<<16|o<<8|n,Ft[0]},Be=(t,e)=>{let o=t>>24&255,n=t>>16&255,r=t>>8&255,a=t&255;e[0]=n,e[1]=r,e[2]=a,e[3]=o};var l=[],yt={},et=t=>{let e=l.length;return l.push(t),e},mt=(t,e)=>{let o=`${t}_${e}`;if(!yt[o]){let n=e>>24&255,r=e>>16&255,a=e>>8&255,s=e&255,c=lt(l[t]);ft(c,i=>{i[0]=r,i[1]=a,i[2]=s,i[3]&&(i[3]=n)}),yt[o]=et(c)}return yt[o]};var ot=tt(),$=0,Nt=()=>{let t=ot;ot=tt(),$=(ot-t)/1e3};var Vt=t=>{let e=0;for(let o of t)e+=o.time;return e},Lt=(t,e)=>{let o=0,n=Vt(t);e%=n;for(let r=0;r<t.length;r++){let a=t[r];if(o+=a.time,e<=o)return a.image}return 0},pt=(t,e)=>{let o=Vt(t);return e>=o};var jt,B=()=>jt,Xt=t=>jt=t,Kt=()=>{let t=B(),e=l[t.back.image];-t.camera.x>0&&(t.camera.x=0),-t.camera.x+e.width<w&&(t.camera.x=e.width-w),-t.camera.y>0&&(t.camera.y=0),-t.camera.y+e.height<v&&(t.camera.y=e.height-v)};var H=[],xt=t=>{let e={config:t,state:0,controller:{move:{x:0,y:0},hand:!1,leg:!1},health:0,direction:1,position:{x:0,y:0},animationTime:0,sprite:{image:0},shadow:{image:0}};return H.push(e),e};var Jt=()=>{H.splice(0,H.length)},Qt=()=>{let t=B();for(let e of H.values())e.position.x=wt(t.bounds.x,t.bounds.x+t.bounds.w,e.position.x),e.position.y=wt(t.bounds.y,t.bounds.y+t.bounds.h,e.position.y)},Zt=()=>{for(let t of H.values())We(t)},We=t=>{let e=null,o=t.config,n=o.animations;switch(t.state){case 0:t.position.x=S(t.position.x),t.position.y=S(t.position.y),e=n.stand,(t.controller.move.x!=0||t.controller.move.y!=0)&&(t.state=1,t.animationTime=0),Yt(t);break;case 1:t.controller.move.x!=0?e=n.walkH:t.controller.move.y!=0?e=n.walkV:(t.state=0,t.animationTime=0);let r=Pt(t.controller.move.x,t.controller.move.y);if(r>0){let a=1/r;t.controller.move.x*=a,t.controller.move.y*=a}t.position.x+=t.controller.move.x*o.walkSpeed*$,t.position.y+=t.controller.move.y*o.walkSpeed*$,Yt(t);break;case 2:e=n.jab,pt(e,t.animationTime)&&(t.controller.hand?t.state=3:t.state=0,t.animationTime=0);break;case 3:e=n.cross,pt(e,t.animationTime)&&(t.controller.hand||(t.state=0,t.animationTime=0));break;case 4:e=n.kick,pt(e,t.animationTime)&&(t.state=0,t.animationTime=0);break}t.controller.move.x>0?t.direction=1:t.controller.move.x<0&&(t.direction=-1),e&&(t.animationTime+=$,t.sprite.image=Lt(e,t.animationTime),t.sprite.flipX=t.direction<0,t.shadow.image=mt(t.sprite.image,1426063360),t.shadow.flipX=t.sprite.flipX)},te=()=>{for(let t of H.values())Ee(t)},Ee=t=>{let e=t.config;t.sprite.x=t.position.x-e.offset.x,t.sprite.y=t.position.y-e.offset.y;let o=l[t.shadow.image];t.shadow.scaleY=.4,t.shadow.x=t.position.x-e.offset.x+0,t.shadow.y=t.position.y-e.offset.y*t.shadow.scaleY},Yt=t=>{t.controller.leg&&(t.state=4,t.animationTime=0),t.controller.hand&&(t.state=2,t.animationTime=0)};var ko=()=>{let t=[];return t[33]=46,t[35]=0,t[46]=47,t[47]=-1,t.push(10,11,12,13,14,15,16,17,18,19),t[64]=0,t.push(20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45),t},_t=ko(),ee=t=>{if(!1)throw`symbol not found ${t} char ${String.fromCharCode(t)}`;return _t[t]};var g=document.getElementById("c");g.style.imageRendering="pixelated";var d=b(g),w=200,v=200,O={x:0,y:0},oe=()=>{let t=window.innerWidth,e=window.innerHeight,o=bt(t/w,e/v);g.width=rt(w,t/o),g.height=rt(v,e/o),g.style.width=`${t}px`,g.style.height=`${e}px`,O.x=ut((g.width-w)/2),O.y=ut((g.height-v)/2)},ne=()=>{d.clearRect(0,0,g.width,g.height),d.setTransform(1,0,0,1,O.x,O.y);let t=B();d.save(),d.translate(S(-t.camera.x),S(-t.camera.y)),kt(t.back),H.sort((e,o)=>e.position.y-o.position.y);for(let e of H)kt(e.shadow);for(let e of H)kt(e.sprite);d.restore(),d.fillStyle="black",g.width<g.height?(d.fillRect(0,-O.y,w,O.y),d.fillRect(0,v,w,v)):(d.fillRect(-O.x,0,O.x,w),d.fillRect(w,0,w,v)),So()},kt=t=>{d.save();let e=l[t.image],o=1,n=0,r=0,a=t.scaleY||1,s=S(t.x||0),c=S(t.y||0);t.flipX&&(o=-1,s+=e.width),d.transform(o,n,r,a,s,c),z(d,e,0,0),d.restore()},So=()=>{if(!1){let t=(tt()-ot).toFixed(),e=(1/$).toFixed();vo(3,3,`FPS ${e} TIME ${t}`,2583691263)}},vo=(t,e,o,n)=>{for(let r=0;r<o.length;r++){let a=o[r].toUpperCase().charCodeAt(0),s=ee(a);if(s!==void 0){let c=mt(s,n),i=l[c];i!==void 0&&z(d,i,t+r*8,e)}}};var re=(...t)=>{let e=U.createBufferSource(),o=U.createBuffer(t.length,t[0].length,y);return t.map((n,r)=>o.getChannelData(r).set(n)),e.buffer=o,e.connect(U.destination),e.start(),e},Co=(t=1,e=.05,o=220,n=0,r=0,a=.1,s=0,c=1,i=0,f=0,m=0,I=0,x=0,M=0,P=0,R=0,h=0,W=1,E=0,j=0)=>{let u=2*Math.PI,X=i*=500*u/y**2,K=(0<P?1:-1)*u/4,V=o*=(1+2*e*Math.random()-e)*u/y,G=[],k=0,Y=0,p=0,A=1,ht=0,Re=0,F=0,J,L;for(n=99+y*n,E*=y,r*=y,a*=y,h*=y,f*=500*u/y**3,P*=u/y,m*=u/y,I*=y,x=y*x|0,L=n+E+r+a+h|0;p<L;G[p++]=F)++Re%(100*R|0)||(F=s?1<s?2<s?3<s?Math.sin((k%u)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/u%2+2)%2:1-4*Math.abs(Math.round(k/u)-k/u):Math.sin(k),F=(x?1-j+j*Math.sin(2*Math.PI*p/x):1)*(0<F?1:-1)*Math.abs(F)**c*t*Io*(p<n?p/n:p<n+E?1-(p-n)/E*(1-W):p<n+E+r?W:p<L-h?(L-p-h)/a*W:0),F=h?F/2+(h>p?0:(p<L-h?1:(L-p)/h)*G[p-h|0]/2):F),J=(o+=i+=f)*Math.sin(Y*P-K),k+=J-J*M*(1-1e9*(Math.sin(p)+1)%2),Y+=J-J*M*(1-1e9*(Math.sin(p)**2+1)%2),A&&++A>I&&(o+=m,V+=m,A=0),!x||++ht%x||(o=V,i=X,A=A||1);return G},Io=.3,y=44100,U=new(window.AudioContext||webkitAudioContext),ae=(t,e,o,n=125)=>{let r,a,s,c,i,f,m,I,x,M,P,R,h,W,E=0,j,u=[],X=[],K=[],V=0,G=0,k=1,Y={},p=44100/n*60>>2;for(;k;V++)u=[k=I=P=h=0],o.map((A,ht)=>{for(m=e[A][V]||[0,0,0],k|=!!e[A][V],j=h+(e[A][0].length-2-!I)*p,W=ht==o.length-1,a=2,c=h;a<m.length+W;I=++a){for(i=m[a],x=a==m.length+W-1&&W||M!=(m[0]||0)|i|0,s=0;s<p&&I;s++>p-99&&x?R+=(R<1)/99:0)f=(1-R)*u[E++]/2||0,X[c]=(X[c]||0)-f*G+f,K[c]=(K[c++]||0)+f*G+f;i&&(R=i%1,G=m[1]||0,(i|=0)&&(u=Y[[M=m[E=0]||0,i]]=Y[[M,i]]||(r=[...t[M]],r[2]=(r[2]||220)*2**((i-12)/12),i>0?Co(...r):[])))}h=j});return[X,K]};var dt=(t=!1)=>{(t||U.state==="suspended")&&U.resume().catch()},se=async t=>{let e=await Mo(t),o=re(...e);o.loop=!0,U.resume()},Mo=async t=>(await Bt(50),ae(...t));var St={},ie=!1,ce=()=>{st.onkeydown=t=>{dt(),ie=!0,St[t.keyCode]=!0,t.preventDefault()},st.onkeyup=t=>{ie=!1,Po(t.keyCode),t.preventDefault()},g.onmousedown=()=>{dt()},g.ontouchstart=()=>{dt()}},C=t=>St[t],Po=t=>delete St[t];var Eo={walkSpeed:30,offset:{x:16,y:29},animations:{stand:[{image:48,time:.2},{image:49,time:.2},{image:50,time:.2},{image:49,time:.2},{image:48,time:.2},{image:51,time:.2}],walkH:[{image:48,time:.1},{image:52,time:.1},{image:53,time:.1},{image:52,time:.1}],walkV:[{image:59,time:.1},{image:60,time:.1},{image:59,time:.1},{image:61,time:.1}],jab:[{image:48,time:.05},{image:56,time:.1}],cross:[{image:56,time:.1},{image:57,time:.1},{image:58,time:.1},{image:57,time:.1}],kick:[{image:48,time:.05},{image:54,time:.05},{image:55,time:.1},{image:54,time:.1}]}},_,ge=()=>{_=xt(Eo)},gt=()=>_,he=()=>{_&&(_.controller.move.x=0,_.controller.move.y=0,_.controller.leg=!1,_.controller.hand=!1,(C(37)||C(65))&&(_.controller.move.x=-1),(C(39)||C(68))&&(_.controller.move.x=1),(C(38)||C(87))&&(_.controller.move.y=-1),(C(40)||C(83))&&(_.controller.move.y=1),C(90)&&(_.controller.leg=!0),C(88)&&(_.controller.hand=!0))};var Qn=1*(Math.exp(.5)-1);var ue,be=[];Tt||Fo();function Fo(){ue||(ue=new AudioContext,!1)}async function we(){let e=await(await fetch("r")).arrayBuffer(),o=new Uint8Array(e),n=0,r=o[n++]*4,a=o.slice(n,n+r);n+=r;let s=o[n++];for(;s--;){let i=o[n++],f=o[n++],m=i*f,I=o.slice(n,n+m);n+=m;let x=Ht();Rt(x,i),At(x,f);let M=x.getImageData(0,0,i,f);for(let P=0;P<I.length;P++){let R=I[P]<<2;M.data.set(a.slice(R,R+4),P<<2)}x.putImageData(M,0,0),l.push(it(x))}let c=o[n++];for(;c--;){let i=o[n++];be.push(e.slice(n,n+i)),n+=i}}var ye=[[[.6,0,100,,,.2,1,.5,,-10,,,,3,,,,10],[.7,0,110,,,.2,2,.1,,,,,,,,,,,.1,.4],[1.3,0,300,,,0,4,3,,,300,,,1,,,,.3,.2],[,0,,,.13,.7,2,.2,,,,,.04,.3,,.02,1,,.3,.1],[3,0,60,,,,3,.2,,,,.5,,.6,1,.05],[,0],[,0]],[[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,3,,15,,3,,15,,],[3,.3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,1,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,4,,16,16,4,,16,16,4,,16,,4,,16,16,4,,16,16,4,,16,16,3,,15,15,3,,15,15],[3,.4,,,,,20,,,,,,23,,,,,,25,,,,,,27,,,,,,25,,,,27,,,,,,,,,,,,,,,,28,,27,,,,25,,,,27,,,,25,,]]],[0,0,1,1],,];var ke=[],Oo=[4278190080,4294939392,4287898002,4289362242,4284354049,4290735454,4278215936,4278217323,4278261885],Uo={walkSpeed:30,offset:{x:16,y:31},animations:{stand:[{image:62,time:.2}],walkH:[{image:62,time:.2}],walkV:[{image:62,time:.2}],jab:[{image:62,time:.2}],cross:[{image:62,time:.2}],kick:[{image:62,time:.2}]}},Ct=[],Se=()=>{let t=Gt(l[62]);for(let e of t)console.log(`0x${e.toString(16)}`);Ct.push(_e([4278190080,4294939392,4281545523,4281545523,4288256409,4294939392,4278190131,4278190131,4278190080],"bob")),Ct.push(_e([4278190080,4294939392,4285642965,4294939392,4294939392,4278190080,4286151563,4286151563,4278190080],"jack"))},_e=(t,e)=>{let o=zt(Uo),n=o.animations;for(let r in n){let a=n[r];Do(a,Oo,t,e)}return o},Do=(t,e,o,n)=>{for(let r of t)r.image=Go(r.image,e,o,n)},vt={},Go=(t,e,o,n)=>{let r=`${t}_${n}`;if(!vt[r]){let a=lt(l[62]);qt(a,e,o),vt[r]=et(a)}return vt[r]},It=t=>{let e=xt(Ct[t]);return ke.push(e),e};var ve=()=>{for(let t of ke)t.controller.move.x=0,t.controller.move.y=0,t.controller.leg=!1,t.controller.hand=!1};var Ie=()=>{let n=Yo(400,150),r=Jo(400,95),a=q(),s=b(a);a.width=400,a.height=245,z(s,r,0,0),z(s,n,0,95);let c=et(a),i=10,f=5;return{bounds:{x:i,y:95+f,w:400-i*2,h:150-f*2},back:{image:c},camera:{x:0,y:0}}},Yo=(t,e)=>{let o=Ot(t,e,[0,1,2,3],[3,2,1,1]),n=b(o),r=30;return n.fillStyle="black",n.fillRect(0,0,o.width,1),ct(n,0,0,o.width,r,1996488704,0),ct(n,0,o.height-r,o.width,r,0,1996488704),Me(10,o),o},Jo=(t,e)=>{let o=Ut(t,e,4),n=b(o),r=[5,6,7],a=[2,1,1],s=50;for(let i=0;i<t;i+=s)for(let f=0;f<t;f+=16){let m=l[at(r,a)];z(n,m,i,f)}Dt([8,s-13,0,8,s*3-13,0,8,s*6-13,0,9,s*2-17,0,9,s*5-30,0],n);let c=40;return ct(n,0,o.height-c,o.width,c,0,1996488704),Me(10,o),o},Me=(t,e)=>{let o=b(e),n=t/2,r=o.getImageData(0,0,e.width,e.height),a=r.data,s=0;for(;s<a.length;){let c=a[s],i=a[s+1],f=a[s+2];a[s]=c-n+t*Z(),a[s+1]=i-n+t*Z(),a[s+2]=f-n+t*Z(),s+=4}o.putImageData(r,0,0)};var Pe=()=>{Xt(Ie()),Jt(),ge();let t=B(),e=It(0);e.position.x=t.bounds.x+100,e.position.y=t.bounds.y+t.bounds.h/2;let o=It(1);o.position.x=t.bounds.x+120,o.position.y=t.bounds.y+t.bounds.h/2+20;let n=gt();n.position.x=t.bounds.x+50,n.position.y=t.bounds.y+t.bounds.h/2};var Te=()=>{let t=B(),e=gt();t.camera.x=e.position.x-w/2,t.camera.y=e.position.y-v/2};!1;var He=()=>{Nt(),oe(),he(),ve(),Zt(),Qt(),Te(),Kt(),te(),ne(),requestAnimationFrame(He)};async function Qo(){await we(),se(ye),ce(),Se(),Pe(),He()}Qo();})();
//# sourceMappingURL=s.js.map

"use strict";(()=>{var H=Math,pt=H.floor,J=H.ceil,v=H.round,dt=H.min,ot=H.max,bt=H.hypot,Fo=H.abs,Q=H.random,Bo=H.atan2,_e=H.PI,Uo=_e*2,ht=(t,e,o)=>dt(e,ot(t,o));function nt(t,e){let o=e.reduce((r,s)=>r+s,0),n=Q()*o,a=0;for(let r=0;r<t.length;r++)if(a+=e[r],n<a)return t[r];return t[0]}var rt=document,St="ontouchstart"in window;var ye="canvas",w=t=>t.getContext("2d"),G=()=>rt.createElement(ye),vt=()=>w(G()),at=t=>t.canvas;var kt=(t,e)=>at(t).width=e,Ct=(t,e)=>at(t).height=e;var z=(t,e,o,n)=>t.drawImage(e,v(o),v(n));var Z=()=>performance.now();async function It(t){return new Promise(e=>{setTimeout(e,t)})}var Mt=t=>{let e=t>>24&255,o=t>>16&255,n=t>>8&255,a=t&255;return`rgba(${o}, ${n}, ${a}, ${e/255})`},Tt=(t,e,o,n,a,r,s)=>{let c=t.createLinearGradient(e,o,n,a);return c.addColorStop(0,Mt(r)),c.addColorStop(1,Mt(s)),c};var Ht=(t,e,o,n)=>{let a=G(),r=w(a),s=p[o[0]];a.width=t,a.height=e;let c=J(t/s.width),i=J(e/s.height);for(let f=0;f<c;f++)for(let l=0;l<i;l++)s=p[nt(o,n)],r.drawImage(s,f*s.width,l*s.height);return a},Rt=(t,e,o)=>{let n=G(),a=w(n);n.width=t,n.height=e;let r=p[o],s=J(t/r.width),c=J(e/r.height);for(let i=0;i<s;i++)for(let f=0;f<c;f++)a.drawImage(r,i*r.width,f*r.height);return n},Pt=(t,e)=>{for(let o=0;o<t.length;o+=3){let n=t[o],a=t[o+1],r=t[o+2],s=p[n];z(e,s,a,r)}},st=(t,e,o,n,a,r,s)=>{t.fillStyle=Tt(t,e,o,e,o+a,r,s),t.fillRect(e,o,n,a)};var zt=(t,e)=>{let o=w(t),n=t.width,a=t.height,r=o.getImageData(0,0,n,a),s=r.data,c=0;for(;c<s.length;){let i=s.slice(c,c+4);e(i),s.set(i,c),c+=4}o.putImageData(r,0,0)},At=t=>{var e=G(),o=w(e);return e.width=t.width,e.height=t.height,o.drawImage(t,0,0),e};var p=[],xt={};var gt=t=>{let e=p.length;return p.push(t),e},it=(t,e)=>{let o=`${t}_${e}`;if(!xt[o]){let n=e>>24&255,a=e>>16&255,r=e>>8&255,s=e&255,c=At(p[t]);zt(c,i=>{i[0]=a,i[1]=r,i[2]=s,i[3]&&(i[3]=n)}),xt[o]=gt(c)}return xt[o]};var tt=Z(),q=0,Wt=()=>{let t=tt;tt=Z(),q=(tt-t)/1e3};var Et=t=>{let e=0;for(let o of t)e+=o.time;return e},Ft=(t,e)=>{let o=0,n=Et(t);e%=n;for(let a=0;a<t.length;a++){let r=t[a];if(o+=r.time,e<=o)return r.image}return 0},ct=(t,e)=>{let o=Et(t);return e>=o};var Bt,A=()=>Bt,Ut=t=>Bt=t,Dt=()=>{let t=A(),e=p[t.back.image];-t.camera.x>0&&(t.camera.x=0),-t.camera.x+e.width<_&&(t.camera.x=e.width-_),-t.camera.y>0&&(t.camera.y=0),-t.camera.y+e.height<k&&(t.camera.y=e.height-k)};var W=[],Gt=t=>{let e={config:t,state:0,controller:{move:{x:0,y:0},hand:!1,leg:!1},health:0,direction:1,position:{x:0,y:0},animationTime:0,sprite:{image:0},shadow:{image:0}};return W.push(e),e};var qt=()=>{W.splice(0,W.length)},Nt=()=>{let t=A();for(let e of W.values())e.position.x=ht(t.bounds.x,t.bounds.x+t.bounds.w,e.position.x),e.position.y=ht(t.bounds.y,t.bounds.y+t.bounds.h,e.position.y)},Vt=()=>{for(let t of W.values())be(t)},be=t=>{let e=null,o=t.config,n=o.animations;switch(t.state){case 0:t.position.x=v(t.position.x),t.position.y=v(t.position.y),e=n.stand,(t.controller.move.x!=0||t.controller.move.y!=0)&&(t.state=1,t.animationTime=0),Ot(t);break;case 1:t.controller.move.x!=0?e=n.walkH:t.controller.move.y!=0?e=n.walkV:(t.state=0,t.animationTime=0);let a=bt(t.controller.move.x,t.controller.move.y);if(a>0){let r=1/a;t.controller.move.x*=r,t.controller.move.y*=r}t.position.x+=t.controller.move.x*o.walkSpeed*q,t.position.y+=t.controller.move.y*o.walkSpeed*q,Ot(t);break;case 2:e=n.jab,ct(e,t.animationTime)&&(t.controller.hand?t.state=3:t.state=0,t.animationTime=0);break;case 3:e=n.cross,ct(e,t.animationTime)&&(t.controller.hand||(t.state=0,t.animationTime=0));break;case 4:e=n.kick,ct(e,t.animationTime)&&(t.state=0,t.animationTime=0);break}t.controller.move.x>0?t.direction=1:t.controller.move.x<0&&(t.direction=-1),e&&(t.animationTime+=q,t.sprite.image=Ft(e,t.animationTime),t.sprite.flipX=t.direction<0,t.shadow.image=it(t.sprite.image,1426063360),t.shadow.flipX=t.sprite.flipX)},Lt=()=>{for(let t of W.values())Se(t)},Se=t=>{let e=t.config;t.sprite.x=t.position.x-e.offset.x,t.sprite.y=t.position.y-e.offset.y;let o=p[t.shadow.image];t.shadow.scaleY=.4,t.shadow.x=t.position.x-e.offset.x+0,t.shadow.y=t.position.y-e.offset.y*t.shadow.scaleY},Ot=t=>{t.controller.leg&&(t.state=4,t.animationTime=0),t.controller.hand&&(t.state=2,t.animationTime=0)};var io=()=>{let t=[];return t[33]=46,t[35]=0,t[46]=47,t[47]=-1,t.push(10,11,12,13,14,15,16,17,18,19),t[64]=0,t.push(20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45),t},ut=io(),$t=t=>{if(!1)throw`symbol not found ${t} char ${String.fromCharCode(t)}`;return ut[t]};var x=document.getElementById("c");x.style.imageRendering="pixelated";var h=w(x),_=200,k=200,U={x:0,y:0},Xt=()=>{let t=window.innerWidth,e=window.innerHeight,o=dt(t/_,e/k);x.width=ot(_,t/o),x.height=ot(k,e/o),x.style.width=`${t}px`,x.style.height=`${e}px`,U.x=pt((x.width-_)/2),U.y=pt((x.height-k)/2)},Kt=()=>{h.clearRect(0,0,x.width,x.height),h.setTransform(1,0,0,1,U.x,U.y);let t=A();h.save(),h.translate(v(-t.camera.x),v(-t.camera.y)),wt(t.back);for(let e of W.values())wt(e.shadow);for(let e of W.values())wt(e.sprite);h.restore(),h.fillStyle="black",x.width<x.height?(h.fillRect(0,-U.y,_,U.y),h.fillRect(0,k,_,k)):(h.fillRect(-U.x,0,U.x,_),h.fillRect(_,0,_,k)),co()},wt=t=>{h.save();let e=p[t.image],o=1,n=0,a=0,r=t.scaleY||1,s=v(t.x||0),c=v(t.y||0);t.flipX&&(o=-1,s+=e.width),h.transform(o,n,a,r,s,c),z(h,e,0,0),h.restore()},co=()=>{if(!1){let t=(Z()-tt).toFixed(),e=(1/q).toFixed();fo(3,3,`FPS ${e} TIME ${t}`,2583691263)}},fo=(t,e,o,n)=>{for(let a=0;a<o.length;a++){let r=o[a].toUpperCase().charCodeAt(0),s=$t(r);if(s!==void 0){let c=it(s,n),i=p[c];i!==void 0&&z(h,i,t+a*8,e)}}};var jt=(...t)=>{let e=D.createBufferSource(),o=D.createBuffer(t.length,t[0].length,y);return t.map((n,a)=>o.getChannelData(a).set(n)),e.buffer=o,e.connect(D.destination),e.start(),e},lo=(t=1,e=.05,o=220,n=0,a=0,r=.1,s=0,c=1,i=0,f=0,l=0,I=0,d=0,M=0,T=0,R=0,g=0,E=1,F=0,$=0)=>{let u=2*Math.PI,X=i*=500*u/y**2,K=(0<T?1:-1)*u/4,V=o*=(1+2*e*Math.random()-e)*u/y,O=[],S=0,j=0,m=0,P=1,mt=0,we=0,B=0,Y,L;for(n=99+y*n,F*=y,a*=y,r*=y,g*=y,f*=500*u/y**3,T*=u/y,l*=u/y,I*=y,d=y*d|0,L=n+F+a+r+g|0;m<L;O[m++]=B)++we%(100*R|0)||(B=s?1<s?2<s?3<s?Math.sin((S%u)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/u%2+2)%2:1-4*Math.abs(Math.round(S/u)-S/u):Math.sin(S),B=(d?1-$+$*Math.sin(2*Math.PI*m/d):1)*(0<B?1:-1)*Math.abs(B)**c*t*mo*(m<n?m/n:m<n+F?1-(m-n)/F*(1-E):m<n+F+a?E:m<L-g?(L-m-g)/r*E:0),B=g?B/2+(g>m?0:(m<L-g?1:(L-m)/g)*O[m-g|0]/2):B),Y=(o+=i+=f)*Math.sin(j*T-K),S+=Y-Y*M*(1-1e9*(Math.sin(m)+1)%2),j+=Y-Y*M*(1-1e9*(Math.sin(m)**2+1)%2),P&&++P>I&&(o+=l,V+=l,P=0),!d||++mt%d||(o=V,i=X,P=P||1);return O},mo=.3,y=44100,D=new(window.AudioContext||webkitAudioContext),Yt=(t,e,o,n=125)=>{let a,r,s,c,i,f,l,I,d,M,T,R,g,E,F=0,$,u=[],X=[],K=[],V=0,O=0,S=1,j={},m=44100/n*60>>2;for(;S;V++)u=[S=I=T=g=0],o.map((P,mt)=>{for(l=e[P][V]||[0,0,0],S|=!!e[P][V],$=g+(e[P][0].length-2-!I)*m,E=mt==o.length-1,r=2,c=g;r<l.length+E;I=++r){for(i=l[r],d=r==l.length+E-1&&E||M!=(l[0]||0)|i|0,s=0;s<m&&I;s++>m-99&&d?R+=(R<1)/99:0)f=(1-R)*u[F++]/2||0,X[c]=(X[c]||0)-f*O+f,K[c]=(K[c++]||0)+f*O+f;i&&(R=i%1,O=l[1]||0,(i|=0)&&(u=j[[M=l[F=0]||0,i]]=j[[M,i]]||(a=[...t[M]],a[2]=(a[2]||220)*2**((i-12)/12),i>0?lo(...a):[])))}g=$});return[X,K]};var ft=(t=!1)=>{(t||D.state==="suspended")&&D.resume().catch()},Jt=async t=>{let e=await po(t),o=jt(...e);o.loop=!0,D.resume()},po=async t=>(await It(50),Yt(...t));var _t={},Qt=!1,Zt=()=>{rt.onkeydown=t=>{ft(),Qt=!0,_t[t.keyCode]=!0,t.preventDefault()},rt.onkeyup=t=>{Qt=!1,ho(t.keyCode),t.preventDefault()},x.onmousedown=()=>{ft()},x.ontouchstart=()=>{ft()}},C=t=>_t[t],ho=t=>delete _t[t];var So={walkSpeed:30,offset:{x:16,y:29},animations:{stand:[{image:48,time:.2},{image:49,time:.2},{image:50,time:.2},{image:49,time:.2},{image:48,time:.2},{image:51,time:.2}],walkH:[{image:48,time:.1},{image:52,time:.1},{image:53,time:.1},{image:52,time:.1}],walkV:[{image:59,time:.1},{image:60,time:.1},{image:59,time:.1},{image:61,time:.1}],jab:[{image:48,time:.05},{image:56,time:.1}],cross:[{image:56,time:.1},{image:57,time:.1},{image:58,time:.1},{image:57,time:.1}],kick:[{image:48,time:.05},{image:54,time:.05},{image:55,time:.1},{image:54,time:.1}]}},b,se=()=>{b=Gt(So)},lt=()=>b,ie=()=>{b&&(b.controller.move.x=0,b.controller.move.y=0,b.controller.leg=!1,b.controller.hand=!1,(C(37)||C(65))&&(b.controller.move.x=-1),(C(39)||C(68))&&(b.controller.move.x=1),(C(38)||C(87))&&(b.controller.move.y=-1),(C(40)||C(83))&&(b.controller.move.y=1),C(90)&&(b.controller.leg=!0),C(88)&&(b.controller.hand=!0))};var Wn=1*(Math.exp(.5)-1);var ce,fe=[];St||vo();function vo(){ce||(ce=new AudioContext,!1)}async function le(){let e=await(await fetch("r")).arrayBuffer(),o=new Uint8Array(e),n=0,a=o[n++]*4,r=o.slice(n,n+a);n+=a;let s=o[n++];for(;s--;){let i=o[n++],f=o[n++],l=i*f,I=o.slice(n,n+l);n+=l;let d=vt();kt(d,i),Ct(d,f);let M=d.getImageData(0,0,i,f);for(let T=0;T<I.length;T++){let R=I[T]<<2;M.data.set(r.slice(R,R+4),T<<2)}d.putImageData(M,0,0),p.push(at(d))}let c=o[n++];for(;c--;){let i=o[n++];fe.push(e.slice(n,n+i)),n+=i}}var me=[[[.6,0,100,,,.2,1,.5,,-10,,,,3,,,,10],[.7,0,110,,,.2,2,.1,,,,,,,,,,,.1,.4],[1.3,0,300,,,0,4,3,,,300,,,1,,,,.3,.2],[,0,,,.13,.7,2,.2,,,,,.04,.3,,.02,1,,.3,.1],[3,0,60,,,,3,.2,,,,.5,,.6,1,.05],[,0],[,0]],[[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,1,,13,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,4,,16,,3,,15,,3,,15,,],[3,.3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[2,.1,1,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,1],[1,.1,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,1,,13,,1,,13,13,1,,13,13,4,,16,16,4,,16,16,4,,16,,4,,16,16,4,,16,16,4,,16,16,3,,15,15,3,,15,15],[3,.4,,,,,20,,,,,,23,,,,,,25,,,,,,27,,,,,,25,,,,27,,,,,,,,,,,,,,,,28,,27,,,,25,,,,27,,,,25,,]]],[0,0,1,1],,];var de=()=>{let n=zo(400,150),a=Ao(400,95),r=G(),s=w(r);r.width=400,r.height=245,z(s,a,0,0),z(s,n,0,95);let c=gt(r),i=10,f=5;return{bounds:{x:i,y:95+f,w:400-i*2,h:150-f*2},back:{image:c},camera:{x:0,y:0}}},zo=(t,e)=>{let o=Ht(t,e,[0,1,2,3],[3,2,1,1]),n=w(o),a=30;return n.fillStyle="black",n.fillRect(0,0,o.width,1),st(n,0,0,o.width,a,1996488704,0),st(n,0,o.height-a,o.width,a,0,1996488704),he(10,o),o},Ao=(t,e)=>{let o=Rt(t,e,4),n=w(o),a=[5,6,7],r=[2,1,1],s=50;for(let i=0;i<t;i+=s)for(let f=0;f<t;f+=16){let l=p[nt(a,r)];z(n,l,i,f)}Pt([8,s-13,0,8,s*3-13,0,8,s*6-13,0,9,s*2-17,0,9,s*5-30,0],n);let c=40;return st(n,0,o.height-c,o.width,c,0,1996488704),he(10,o),o},he=(t,e)=>{let o=w(e),n=t/2,a=o.getImageData(0,0,e.width,e.height),r=a.data,s=0;for(;s<r.length;){let c=r[s],i=r[s+1],f=r[s+2];r[s]=c-n+t*Q(),r[s+1]=i-n+t*Q(),r[s+2]=f-n+t*Q(),s+=4}o.putImageData(a,0,0)};var xe=()=>{Ut(de()),qt(),se();let t=A(),e=lt();e.position.x=t.bounds.x+50,e.position.y=t.bounds.y+t.bounds.h/2};var ge=()=>{let t=A(),e=lt();t.camera.x=e.position.x-_/2,t.camera.y=e.position.y-k/2};!1;var ue=()=>{Wt(),Xt(),ie(),Vt(),Nt(),ge(),Dt(),Lt(),Kt(),requestAnimationFrame(ue)};async function Wo(){await le(),Jt(me),Zt(),xe(),ue()}Wo();})();
//# sourceMappingURL=s.js.map
